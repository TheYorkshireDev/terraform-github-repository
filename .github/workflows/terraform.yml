name: Terraform

on:
  pull_request:

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Install terraform-docs
        working-directory: /tmp
        run: |
          curl -sSLo ./terraform-docs.tar.gz https://terraform-docs.io/dl/v0.16.0/terraform-docs-v0.16.0-$(uname)-amd64.tar.gz
          tar -xzf terraform-docs.tar.gz
          chmod +x terraform-docs
          mkdir /home/runner/bin
          mv terraform-docs /home/runner/bin
          ls /home/runner/bin
          echo "/home/runner/bin" >> $GITHUB_PATH
          which terraform-docs
          terraform-docs --version



# mkdir /home/runner/bin
# cd /home/runner/bin
# curl -sSLo ./terraform-docs.tar.gz https://terraform-docs.io/dl/v0.16.0/terraform-docs-v0.16.0-$(uname)-amd64.tar.gz
# tar -xzf terraform-docs.tar.gz
# chmod +x terraform-docs
# echo "/home/runner/bin" >> $GITHUB_PATH
# cd $GITHUB_WORKSPACE
# which terraform-docs
# terraform-docs --version


      # - name: Does This Run Comment
      #   uses: actions/github-script@v6
      #   with:
      #     github-token: ${{ secrets.GITHUB_TOKEN }}
      #     script: |
      #       const execSync = require('child_process').execSync;
      #       const output = execSync('terraform-docs markdown table --indent 2 .', { encoding: 'utf-8' });  // the default is 'buffer'
      #       console.log(output);

      # - name: Add Comment
      #   uses: actions/github-script@v6
      #   with:
      #     github-token: ${{ secrets.GITHUB_TOKEN }}
      #     script: |
      #       const plan1 = '### TODO1'
      #       const plan2 = '### TODO2\nHello World'
      #       const plan3 = '### TODO3\n"Hello World"'

      #       const output = `### ‚ö†Ô∏è Terraform Documentation Outdated
      #       #### Update \`./README.md\` üìñ
      #       <details><summary>Show Markdown</summary>

      #       \`\`\`
      #       ## Title1
      #       ### Subtitle1
      #       ${plan1}
      #       \`\`\`
      #       </details>

      #       #### Update \`./examples/basic-github-repository/README.md\` üìñ
      #       <details><summary>Show Markdown</summary>

      #       \`\`\`
      #       ## Title2
      #       ### Subtitle2
      #       ${plan2}
      #       \`\`\`
      #       </details>

      #       #### Update \`./test/fixtures/basic-repository/README.md\` üìñ
      #       <details><summary>Show Markdown</summary>

      #       \`\`\`
      #       ## Title3
      #       ### Subtitle3
      #       ${plan3}
      #       \`\`\`
      #       </details>
      #       `;

      #       github.rest.issues.createComment({
      #         issue_number: context.issue.number,
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         body: output
      #       })

      # - name: Render terraform docs inside the README.md and push changes back to PR branch
      #   uses: terraform-docs/gh-actions@v1.0.0
      #   with:
      #     find-dir: . # INPUT_FIND_DIR
      #     output-file: README.md #INPUT_OUTPUT_FILE
      #     output-method: print # INPUT_OUTPUT_METHOD
      #     git-push: 'false' # INPUT_GIT_PUSH
